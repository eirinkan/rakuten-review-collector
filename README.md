# 楽天市場レビュー収集 Chrome拡張機能

楽天市場の商品レビューを自動収集し、Googleスプレッドシートに保存またはCSVファイルとしてダウンロードするChrome拡張機能です。

## 機能

- 楽天市場のレビューページから自動でレビューを収集
- ページネーションに対応（複数ページを自動巡回）
- ランダムウェイト（3-6秒）でサーバー負荷を軽減
- 最大3商品の同時並列収集（キュー機能）
- ランキングページからの一括追加対応
- 2つの保存モード（併用可能）:
  - **スプレッドシート自動保存**: GAS URLを設定した場合
  - **CSVダウンロード**: 常に利用可能（商品ごとにZIPでまとめてダウンロード可）

## 収集されるデータ（20項目）

| 項目 | 説明 |
|------|------|
| レビュー日 | レビューが投稿された日付 |
| 商品管理番号 | 楽天の商品管理番号 |
| 商品名 | 商品の名前 |
| 商品URL | 商品ページのURL |
| 評価 | 星の数（1-5） |
| タイトル | レビューのタイトル |
| 本文 | レビューの本文 |
| 投稿者 | 投稿者名 |
| 年代 | 投稿者の年代 |
| 性別 | 投稿者の性別 |
| 注文日 | 商品を注文した日付 |
| バリエーション | サイズ、カラーなど |
| 用途 | 購入目的 |
| 贈り先 | ギフトの場合の贈り先 |
| 購入回数 | リピート購入回数 |
| 参考になった数 | 「参考になった」の投票数 |
| ショップからの返信 | ショップからのコメント |
| ショップ名 | 販売ショップ名 |
| レビュー掲載URL | レビューページのURL |
| 収集日時 | データを収集した日時 |

## ファイル構成

```
rakuten-review-collector/
├── manifest.json        # 拡張機能のマニフェスト (v1.3.2)
├── popup.html           # ポップアップUI
├── popup.js             # ポップアップのスクリプト
├── options.html         # 管理画面（設定・キュー管理）
├── options.js           # 管理画面のスクリプト
├── content.js           # レビュー収集スクリプト（DOM解析）
├── background.js        # Service Worker（バックグラウンド処理）
├── jszip.min.js         # ZIP圧縮ライブラリ
├── gas/                 # Google Apps Script関連
│   ├── Code.gs          # GASメインスクリプト
│   ├── appsscript.json  # GAS設定ファイル
│   └── .clasp.json.example  # clasp設定テンプレート
├── icons/               # アイコン画像
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
├── .gitignore           # Git除外設定
└── README.md            # このファイル
```

## インストール方法

### 1. Chrome拡張機能のインストール

1. このリポジトリをクローンまたはダウンロード
   ```bash
   git clone https://github.com/your-username/rakuten-review-collector.git
   ```
2. Chromeで `chrome://extensions` を開く
3. 右上の「デベロッパーモード」をオンにする
4. 「パッケージ化されていない拡張機能を読み込む」をクリック
5. ダウンロードしたフォルダを選択

### 2. Google Apps Script の設定（スプレッドシート保存を使う場合）

#### 方法A: 拡張機能の管理画面から設定（推奨）

1. 拡張機能アイコンを右クリック →「オプション」または `Alt+Shift+R` で管理画面を開く
2. 「設定」セクションを展開
3. 「スプレッドシート連携の設定方法」の手順に従う
4. 自動生成されたGASコードをコピーしてApps Scriptに貼り付け

#### 方法B: 手動でGASを設定

1. [Google スプレッドシート](https://sheets.google.com/)で新規スプレッドシートを作成
2. メニューから「拡張機能」→「Apps Script」を開く
3. `gas/Code.gs` の内容をコピーして貼り付け
4. **重要**: `SPREADSHEET_ID` を自分のスプレッドシートIDに変更
   ```javascript
   // スプレッドシートURLの https://docs.google.com/spreadsheets/d/XXXXX/edit の XXXXX 部分
   const SPREADSHEET_ID = 'あなたのスプレッドシートID';
   ```
5. 保存（Ctrl+S）
6. 「デプロイ」→「新しいデプロイ」をクリック
7. 「種類の選択」で「ウェブアプリ」を選択
8. 設定:
   - 説明: 任意（例: 楽天レビュー収集）
   - 次のユーザーとして実行: 自分
   - アクセスできるユーザー: **全員**
9. 「デプロイ」をクリック
10. 表示されたURLをコピーし、拡張機能の設定画面に貼り付け

### 3. clasp（GAS CLI）を使う場合（開発者向け）

```bash
# claspをインストール
npm install -g @google/clasp

# ログイン
clasp login

# gas/.clasp.json.example をコピーして .clasp.json を作成
cp gas/.clasp.json.example gas/.clasp.json

# scriptIdを自分のものに変更
# Apps Script エディタのURL https://script.google.com/d/XXXXX/edit の XXXXX 部分

# コードをプッシュ
cd gas
clasp push

# デプロイIDを確認
clasp deployments

# 既存デプロイを更新（URLを変えずにコードを更新）
clasp deploy --deploymentId <デプロイID>

# または新規デプロイ
clasp deploy --description "説明文"
```

**注意**: `clasp push`だけではウェブアプリは更新されません。必ず`clasp deploy`でデプロイを更新してください。

## 使い方

### 単一商品のレビュー収集

1. 楽天市場の商品ページまたはレビューページを開く
2. 拡張機能アイコンをクリック（または `Alt+R`）
3. 「収集開始」ボタンをクリック
4. 収集完了まで待機（ページを閉じないでください）

### 複数商品の一括収集（キュー機能）

1. 各商品ページで「キューに追加」ボタンを押す
2. 管理画面（`Alt+Shift+R`）を開く
3. 「一括収集開始」をクリック
4. 最大3商品が同時に収集される（バックグラウンドウィンドウで実行）

### ランキングからの一括追加

1. 楽天ランキングページを開く
2. 拡張機能アイコンをクリック
3. 商品数を指定して「キューに追加」

## キーボードショートカット

| キー | 機能 |
|------|------|
| `Alt + R` | ポップアップを開く |
| `Alt + Shift + R` | 管理画面を開く |

## スプレッドシートのカスタムメニュー

GASを設定すると、スプレッドシートに「🛠️ レビュー管理」メニューが追加されます（ページをリロード後）:

- **📊 スプレッドシートを初期化**: すべてのシートを削除し、空の「レビュー」シートを作成
- **🔄 重複レビューを削除**: 本文+投稿者で重複を検出して削除

## トラブルシューティング

| 問題 | 解決方法 |
|------|----------|
| 「ページをリロードしてください」と表示される | F5でページをリロードしてから再度収集を開始 |
| スプレッドシートに保存されない | GAS URLが正しいか確認。デプロイ後の「ウェブアプリのURL」を使用 |
| カスタムメニューが表示されない | スプレッドシートをリロード（Ctrl+R） |
| レビューが収集されない | 楽天のページ構造変更の可能性。拡張機能の更新を確認 |

## 注意事項

- 楽天市場の利用規約を確認し、個人利用の範囲でご使用ください
- 大量のリクエストはサーバーに負荷をかけるため、適度な間隔を空けてください
- 収集したデータの取り扱いは自己責任でお願いします
- 単一収集時: 収集中のタブを閉じると中断されます
- キュー収集時: 収集用ウィンドウを閉じると全て中断されます

## バージョン

v1.3.2

## ライセンス

MIT License
